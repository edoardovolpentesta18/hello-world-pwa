<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Gestione Partite</title>
    <script type="module">
        // Import Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getFirestore, collection, addDoc, updateDoc, doc, getDocs } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        // Configura Firebase
       const firebaseConfig = {
          apiKey: "AIzaSyApJJvOyDRxJLgbWMiLJmDEnR-4jSeVDVc",
          authDomain: "ore2025-a18f7.firebaseapp.com",
          projectId: "ore2025-a18f7",
          storageBucket: "ore2025-a18f7.firebasestorage.app",
          messagingSenderId: "324736325409",
          appId: "1:324736325409:web:2fc2868c25b253c8815060",
          measurementId: "G-5D4EEB1C9M"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Funzione per aggiungere squadre
        async function aggiungiSquadra() {
            const squadra = document.getElementById("squadra_nome").value;
            if (squadra) {
                try {
                    await addDoc(collection(db, "squadre"), { nome: squadra });
                    alert("Squadra aggiunta!");
                    document.getElementById("squadra_nome").value = ""; // Pulisce il campo input
                    await caricaSquadre(); // Ricarica i dropdown
                } catch (error) {
                    console.error("Errore durante l'aggiunta della squadra:", error);
                }
            }
        }

        // Esponi la funzione globalmente
        window.aggiungiSquadra = aggiungiSquadra;


        // Funzione per aggiungere giocatori
        async function aggiungiGiocatore() {
            const squadra = document.getElementById("squadra_select").value;
            const giocatore = document.getElementById("giocatore_nome").value;

            if (squadra && giocatore) {
                await addDoc(collection(db, "squadre", squadra, "giocatori"), { nome: giocatore });
                alert("Giocatore aggiunto!");
                caricaGiocatori(squadra);
            }
        }

        // Funzione per caricare squadre nel dropdown
        async function caricaSquadre() {
            console.log("Caricamento squadre...");
            
            const squadreDropdown = document.getElementById("squadra_select");
            const partitaDropdown1 = document.getElementById("squadra1");
            const partitaDropdown2 = document.getElementById("squadra2");
        
            squadreDropdown.innerHTML = "<option value=''>Seleziona Squadra</option>";
            partitaDropdown1.innerHTML = "<option value=''>Seleziona Squadra</option>";
            partitaDropdown2.innerHTML = "<option value=''>Seleziona Squadra</option>";
        
            try {
                const querySnapshot = await getDocs(collection(db, "squadre"));
                querySnapshot.forEach((doc) => {
                    const squadra = doc.data().nome;
                    console.log("Squadra trovata:", squadra);
                    
                    const option = `<option value="${doc.id}">${squadra}</option>`;
                    squadreDropdown.innerHTML += option;
                    partitaDropdown1.innerHTML += option;
                    partitaDropdown2.innerHTML += option;
                });
            } catch (error) {
                console.error("Errore nel caricamento delle squadre:", error);
            }
        }


        // Funzione per caricare i giocatori della squadra selezionata
        async function caricaGiocatori(squadraId) {
            const giocatoriDropdown = document.getElementById("giocatore_select");
            giocatoriDropdown.innerHTML = "<option value=''>Seleziona Giocatore</option>";

            const querySnapshot = await getDocs(collection(db, "squadre", squadraId, "giocatori"));
            querySnapshot.forEach((doc) => {
                const giocatore = doc.data().nome;
                giocatoriDropdown.innerHTML += `<option value="${doc.id}">${giocatore}</option>`;
            });
        }

        // Funzione per inserire una partita
        async function inserisciPartita() {
            const girone = document.getElementById("girone").value;
            const squadra1 = document.getElementById("squadra1").value;
            const squadra2 = document.getElementById("squadra2").value;
            const gol1 = document.getElementById("gol1").value;
            const gol2 = document.getElementById("gol2").value;

            if (girone && squadra1 && squadra2 && gol1 !== "" && gol2 !== "") {
                const risultato = `${gol1}-${gol2}`;
                await addDoc(collection(db, "partite", girone, "partite"), {
                    squadra1,
                    squadra2,
                    risultato
                });
                alert("Partita inserita!");
            }
        }

        // Caricamento iniziale delle squadre
        document.addEventListener("DOMContentLoaded", () => {
            caricaSquadre();
        });

    </script>
</head>
<body>
    <h1>Admin - Gestione Torneo</h1>

    <h2>Aggiungi Squadra</h2>
    <input type="text" id="squadra_nome" placeholder="Nome Squadra">
    <button onclick="aggiungiSquadra()">Aggiungi Squadra</button>

    <h2>Aggiungi Giocatori</h2>
    <label for="squadra_select">Squadra:</label>
    <select id="squadra_select" onchange="caricaGiocatori(this.value)"></select>
    <input type="text" id="giocatore_nome" placeholder="Nome Giocatore">
    <button onclick="aggiungiGiocatore()">Aggiungi Giocatore</button>

    <h2>Inserisci Partita</h2>
    <label for="girone">Girone:</label>
    <select id="girone">
        <option value="girone_A">Girone A</option>
        <option value="girone_B">Girone B</option>
    </select>
    <br>
    <label for="squadra1">Squadra 1:</label>
    <select id="squadra1"></select>
    <input type="number" id="gol1" placeholder="Gol" min="0">
    <br>
    <label for="squadra2">Squadra 2:</label>
    <select id="squadra2"></select>
    <input type="number" id="gol2" placeholder="Gol" min="0">
    <br>
    <button onclick="inserisciPartita()">Inserisci Partita</button>
</body>
</html>
